<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Daftar Pengumpulan Laporan - Sistem Monitoring</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    :root{ --navy:#0b2340; --cream:#f7f3ee; --accent:#b78b4a; --muted:#6c757d; }
    body{ background:var(--cream); color:var(--navy); font-family:Inter,system-ui,Arial; }
    .container-main{ max-width:1100px; margin:2rem auto; background:#fff; padding:1.25rem; border-radius:12px; box-shadow:0 8px 20px rgba(11,35,64,0.06); }
    .title { display:flex; align-items:center; gap:.75rem; margin-bottom:1rem; }
    .title h2{ margin:0; font-size:1.2rem; font-weight:700; }
    .btn-add{ background:var(--accent); color:#fff; padding:.4rem .7rem; border-radius:8px; text-decoration:none; font-weight:600; }
    .img-thumb{ width:64px; height:46px; object-fit:cover; border-radius:6px; border:1px solid #e9ecef; }
    
    /* Styling Tombol Aksi Kecil */
    .icon-btn{ width:32px; height:32px; border-radius:6px; display:inline-flex; align-items:center; justify-content:center; border:0; cursor:pointer; transition:0.2s; }
    .icon-btn svg { width:18px; height:18px; }
    
    .icon-view { background:#e9ecef; color:var(--navy); }
    .icon-view:hover { background:#dee2e6; }
    
    .icon-edit { background:#0b74a4; color:#fff; }
    .icon-edit:hover { background:#095b7f; }
    
    .icon-delete { background:#c44d3a; color:#fff; }
    .icon-delete:hover { background:#a63e2d; }

    .badge-status{ padding:.28rem .55rem; border-radius:999px; font-weight:700; font-size:.82rem; }
    .badge-pending{ background:#fff3cd; color:#664d03; }
    .badge-approved{ background:#198754; color:#fff; }
    .badge-rejected{ background:#dc3545; color:#fff; }

    @media(max-width:720px){
      .img-thumb{ width:48px; height:36px; }
      td, th{ font-size:.92rem; }
    }
  </style>
</head>
<body>
  <div th:replace="~{layouts/fragments/navbar :: topbar}"></div>
  <div th:replace="~{layouts/fragments/sidebar :: sidebar}"></div>

  <main class="container-main">
    <div class="d-flex justify-content-between align-items-center title">
      <h2>Daftar Pengumpulan Laporan</h2>
      <a th:href="@{/report-submissions/create}" class="btn-add" th:if="${#authorization.expression('hasAnyAuthority(''STUDENT'', ''Student'')')}">+ Tambah Laporan</a>
    </div>

    <div class="table-responsive">
      <table class="table align-middle mb-0">
        <thead>
          <tr>
            <th style="width:50px;">No</th>
            <th style="width:80px;">File</th>
            <th>Nama Siswa</th>
            <th>Judul Laporan</th>
            <th style="width:120px;">Status</th>
            <th>Catatan</th>
            <th style="width:140px;">Aksi</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="sub, iterStat : ${submission}"> <td th:text="${iterStat.count}">1</td>
            
            <td>
              <div th:if="${sub.filePath != null and sub.filePath!= ''}">
                <a th:href="@{${sub.filePath}}" target="_blank">
                   <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" viewBox="0 0 24 24" stroke="#b78b4a" stroke-width="1.5">
                     <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                   </svg>
                </a>
              </div>
              <span th:if="${sub.filePath == null}">-</span>
            </td>

            <td th:text="${sub.student?.user?.username ?: 'â€”'}">Nama Siswa</td>

            <td th:text="${sub.fileTitle}">Judul</td>
            
            <td>
              <span class="badge-status" 
                    th:classappend="${#strings.toString(sub.status) == 'APPROVED'} ? 'badge-approved' : 
                                   (${#strings.toString(sub.status) == 'REJECTED'} ? 'badge-rejected' : 'badge-pending')"
                    th:text="${sub.status}">Pending</span>
            </td>
            
            <td th:text="${sub.studentNotes ?: '-'}">Catatan</td>

            <td>
              <div class="d-flex gap-1">
                
                <a th:href="@{'/report-submissions/' + ${sub.submissionId}}" class="icon-btn icon-view" title="Lihat Detail">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                  </svg>
                </a>

                <a th:href="@{'/report-submissions/edit/' + ${sub.submissionId}}" class="icon-btn icon-edit" title="Edit"
                   th:if="${#authorization.expression('hasAnyAuthority(''ADMINISTRATOR'', ''Administrator'')')}">
                   <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                     <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                   </svg>
                </a>

                <form th:if="${#authorization.expression('hasAnyAuthority(''ADMINISTRATOR'', ''Administrator'')')}" 
                      th:action="@{/report-submissions/{id}(id=${sub.submissionId})}" method="post">
                  <input type="hidden" name="_method" value="delete"/>
                  <button type="submit" class="icon-btn icon-delete" title="Hapus" onclick="return confirm('Yakin ingin menghapus?')">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                  </button>
                </form>

              </div>
            </td>
          </tr>

          <tr th:if="${#lists.isEmpty(submission)}">
            <td colspan="7" class="text-center text-muted py-4">Belum ada laporan yang diupload.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>

  <footer style="text-align:center; color:var(--muted); padding:1rem;">
    &copy; <span th:text="${#temporals.format(#temporals.createNow(),'yyyy')}">2025</span> Sistem Monitoring
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>