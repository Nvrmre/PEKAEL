<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Data Absensi - Sistem Monitoring</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    :root {
      --navy: #0b2340;
      --cream: #f2ece3;
      --accent: #b78b4a;
      --muted: #6c757d;
    }

    body {
      background: var(--cream);
      color: var(--navy);
      font-size: 1rem;
      font-family: system-ui, -apple-system, sans-serif;
    }

    .container-main {
      max-width: 1000px;
      margin: 2rem auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(11, 35, 64, 0.08);
      padding: 2rem;
    }

    /* Header Title Responsif */
    .header-wrapper {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      flex-wrap: wrap; /* Agar tombol turun jika layar sempit */
      gap: 1rem;
    }

    h2.title {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      font-weight: 700;
      font-size: 1.4rem;
      margin: 0;
      color: var(--navy);
    }

    h2.title svg {
      width: 26px;
      height: 26px;
      stroke: var(--accent);
    }

    .btn-add {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 0.4rem 0.9rem;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      font-weight: 600;
      font-size: 0.95rem;
      transition: all 0.2s ease;
      text-decoration: none;
      white-space: nowrap;
    }

    .btn-add:hover {
      background: #a5793e;
      transform: translateY(-2px);
      color: #fff;
    }
    
    .btn-add svg { width: 16px; height: 16px; }

    /* --- TABLE DESKTOP --- */
    table thead {
      background: rgba(11, 35, 64, 0.05);
    }
    th { color: var(--navy); font-weight: 600; text-align: center; }
    td { vertical-align: middle; text-align: center; }
    
    /* Tombol Aksi */
    .btn-icon {
      width: 32px;
      height: 32px;
      border-radius: 6px; /* Kotak rounded sedikit lebih modern */
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border: none;
      cursor: pointer;
      transition: 0.18s;
      padding: 0;
    }

    .btn-edit-icon { background: #0b74a4; color: #fff; }
    .btn-edit-icon:hover { background: #095b7f; transform: scale(1.1); }

    .btn-delete-icon { background: #c44d3a; color: #fff; }
    .btn-delete-icon:hover { background: #a63e2d; transform: scale(1.1); }

    .btn-icon svg { width: 16px; height: 16px; }

    /* Badge Status */
    .badge-status {
      display: inline-block;
      padding: 0.4rem 0.75rem;
      border-radius: 6px;
      font-weight: 600;
      font-size: 0.8rem;
      letter-spacing: 0.5px;
    }

    .badge-hadir { background: #d1e7dd; color: #0f5132; }
    .badge-sakit { background: #cff4fc; color: #055160; }
    .badge-alpha { background: #f8d7da; color: #842029; }
    .badge-izin { background: #fff3cd; color: #664d03; }

    .img-thumb { 
      width: 50px; 
      height: 50px; 
      object-fit: cover; 
      border-radius: 50%; /* Foto bulat lebih modern untuk profil */
      border: 2px solid #e9ecef; 
    }

    /* --- MOBILE RESPONSIVE (Card View) --- */
    @media (max-width: 768px) {
      .container-main {
        margin: 1rem 0.5rem;
        padding: 1.25rem;
      }
      
      h2.title { font-size: 1.25rem; }

      /* Sembunyikan Header Tabel */
      table thead { display: none; }

      /* Baris jadi Kartu */
      table tbody tr {
        display: block;
        background: #fff;
        border: 1px solid #e0e0e0;
        border-radius: 10px;
        margin-bottom: 1rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.03);
        padding: 0.5rem;
      }

      /* Sel jadi Flex Row */
      table tbody td {
        display: flex;
        justify-content: space-between; /* Label kiri, isi kanan */
        align-items: center;
        text-align: right;
        padding: 0.75rem 0.5rem;
        border-bottom: 1px solid #f1f1f1;
      }

      table tbody td:last-child {
        border-bottom: none;
        justify-content: flex-end; /* Tombol aksi di kanan */
      }

      /* Tampilkan Label Kolom via attribute data-label */
      table tbody td::before {
        content: attr(data-label);
        font-weight: 700;
        color: var(--muted);
        font-size: 0.9rem;
        text-align: left;
        margin-right: 1rem;
      }

      /* Styling khusus kolom NO agar jadi Header Kartu */
      table tbody td[data-label="No"] {
        background: var(--navy);
        color: white;
        margin: -0.5rem -0.5rem 0.5rem -0.5rem;
        border-radius: 10px 10px 0 0;
        padding: 0.5rem 1rem;
        justify-content: flex-start;
        font-weight: bold;
      }
      table tbody td[data-label="No"]::before {
        content: "#";
        color: var(--accent);
        margin-right: 5px;
      }

      /* Styling Foto di Mobile */
      table tbody td[data-label="Foto"] {
        justify-content: flex-end;
      }
      
      /* Empty State adjustment */
      table tbody tr.empty-row td {
         display: block;
         text-align: center;
         border: none;
      }
      table tbody tr.empty-row td::before { display: none; }
    }

    footer {
      text-align: center;
      color: var(--muted);
      font-size: 0.9rem;
      padding: 1rem;
      margin-top: 1rem;
    }
  </style>
</head>

<body>
  <div th:replace="~{layouts/fragments/navbar :: topbar}"></div>
  <div th:replace="~{layouts/fragments/sidebar :: sidebar}"></div>

  <main class="container-main">
    <div class="header-wrapper">
      <h2 class="title">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
          stroke-width="1.6">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        Daftar Absensi
      </h2>

      <a th:href="@{/attendances/create}" class="btn-add" title="Tambah Absensi" th:if="${#authorization.expression('hasAnyAuthority(''ADMINISTRATOR'', ''Administrator'')')}">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
          stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
        </svg>
        Tambah
      </a>
    </div>

    <div class="table-responsive-md"> <table class="table align-middle mb-0">
        <thead>
          <tr>
            <th width="50">No</th>
            <th width="80">Foto</th>
            <th>Nama Siswa</th>
            <th>Tanggal</th>
            <th>Waktu</th>
            <th>Status</th>
            <th width="100" th:if="${#authorization.expression('hasAnyAuthority(''ADMINISTRATOR'', ''Administrator'')')}">Aksi</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="att, iterStat : ${attend}">
            <td data-label="No" th:text="${iterStat.count}">1</td>

            <td data-label="Foto">
              <div th:if="${att.checkInPhotoUrl != null and att.checkInPhotoUrl != ''}">
                <img th:src="@{${att.checkInPhotoUrl}}" alt="foto" class="img-thumb" />
              </div>
              <div th:if="${att.checkInPhotoUrl == null or att.checkInPhotoUrl == ''}">
                 <div class="d-flex align-items-center justify-content-center bg-light rounded-circle" style="width:50px; height:50px; border: 1px solid #ddd;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="#ccc" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /></svg>
                </div>
              </div>
            </td>

            <td data-label="Nama Siswa" th:text="${att.placement != null && att.placement.student != null ? att.placement.student.user.username : '—'}" style="font-weight:500;">John Doe</td>

            <td data-label="Tanggal" th:text="${att.date != null ? #temporals.format(att.date, 'dd MMM yyyy') : '-'}">01 Nov 2025</td>

            <td data-label="Waktu" th:text="${att.checkInTime != null ? #temporals.format(att.checkInTime, 'HH:mm') : '-'}">07:45</td>

            <td data-label="Status">
              <span th:switch="${att.presenceStatus}">
                <span th:case="${T(com.sistem.monitoring.models.AttendanceModel.Presence).PRESENT}"
                      class="badge-status badge-hadir">Hadir</span>
                <span th:case="${T(com.sistem.monitoring.models.AttendanceModel.Presence).SICK}"
                      class="badge-status badge-sakit">Sakit</span>
                <span th:case="${T(com.sistem.monitoring.models.AttendanceModel.Presence).ABSENT}"
                      class="badge-status badge-alpha">Alpha</span>
                <span th:case="${T(com.sistem.monitoring.models.AttendanceModel.Presence).PERMISION}"
                      class="badge-status badge-izin">Izin</span>
                <span th:case="*"
                      class="badge-status badge-alpha"
                      th:text="${att.presenceStatus != null ? att.presenceStatus.name() : '—'}">—</span>
              </span>
            </td>

            <td data-label="Aksi" th:if="${#authorization.expression('hasAnyAuthority(''ADMINISTRATOR'', ''Administrator'')')}">
              <div class="d-flex align-items-center justify-content-end justify-content-md-center gap-2">

                <a th:href="@{'/attendances/edit/' + ${att.attendId}}" 
                   class="btn-icon btn-edit-icon"
                   title="Edit">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none"
                    stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round"
                      d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931z"/>
                  </svg>
                </a>

                <form th:action="@{/attendances/{id}(id=${att.attendId})}" method="post" style="display:inline; margin:0;">
                  <input type="hidden" name="_method" value="delete" />
                  <button type="submit" class="btn-icon btn-delete-icon" title="Hapus"
                          onclick="return confirm('Yakin ingin menghapus data ini?')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none"
                      stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round"
                        d="M3 6h18M8 6v12a2 2 0 002 2h4a2 2 0 002-2V6M10 6V4a2 2 0 012-2h0a2 2 0 012 2v2"/>
                    </svg>
                  </button>
                </form>

              </div>
            </td>

          </tr>

          <tr th:if="${#lists.isEmpty(attend)}" class="empty-row">
            <td colspan="7" class="text-center text-muted py-5">
              <div class="d-flex flex-column align-items-center justify-content-center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" stroke="#dee2e6"
                    stroke-width="1.5" class="mb-2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-2m0-4v-2m6 8v-2m0-4v-2M4 4h16v16H4z" />
                  </svg>
                  <span>Belum ada data absensi.</span>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>

  <footer>
    &copy; <span th:text="${#temporals.format(#temporals.createNow(),'yyyy')}">2025</span> Sistem Monitoring — Semua hak
    dilindungi.
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>